{"version":3,"file":"react-antm-formutil.esm.development.js","sources":["../src/FormItem.tsx"],"sourcesContent":["import {\n    Checkbox,\n    DatePicker,\n    ImagePicker,\n    InputItem,\n    List,\n    Modal,\n    Picker,\n    PickerView,\n    Radio,\n    Range,\n    Slider,\n    Switch,\n    TextareaItem\n} from 'antd-mobile';\nimport { ListItemProps } from 'antd-mobile/lib/list/ListItem';\nimport PropTypes from 'prop-types';\nimport React, { Children, cloneElement, Component } from 'react';\nimport { $FieldHandler, BaseEasyFieldComponentProps, EasyField } from 'react-formutil';\n\nexport type ErrorLevel = 0 | 1 | 2 | 'off';\n\nexport interface FormItemProps<T = any, P = {}, Fields = {}, WeakFields = Fields>\n    extends ListItemProps,\n        BaseEasyFieldComponentProps<T, P, Fields, WeakFields> {\n    label?: React.ReactNode;\n    errorLevel?: ErrorLevel;\n    children: React.ReactElement<any>;\n    [prop: string]: any;\n}\n\nconst ListItem = List.Item;\n\nlet errorLevelGlobal = 1;\n\n/**\n * 0 dirty & invalid & touched\n * 1 dirty & invalid\n * 2 invalid\n */\nexport const setErrorLevel = function(level) {\n    errorLevelGlobal = level;\n};\n\nconst isUglify = Switch.name !== 'Switch';\n\nfunction getComponentType(children) {\n    if (children) {\n        if (typeof children.type === 'function') {\n            const func = children.type;\n\n            if (func.formutilType) {\n                return func.formutilType;\n            }\n\n            if (isUglify) {\n                return func;\n            }\n\n            return func.displayName || func.name;\n        } else {\n            return children.props.type || children.type;\n        }\n    }\n}\n\nconst _Checkbox = isUglify ? Checkbox : 'Checkbox';\nconst _Radio = isUglify ? Radio : 'Radio';\nconst _PickerView = isUglify ? PickerView : 'PickerView';\nconst _DatePicker = isUglify ? DatePicker : 'DatePicker';\nconst _Switch = isUglify ? Switch : 'Switch';\nconst _Range = isUglify ? Range : 'Range';\nconst _Picker = isUglify ? Picker : 'Picker';\nconst _ImagePicker = isUglify ? ImagePicker : 'ImagePicker';\nconst _InputItem = isUglify ? InputItem : 'InputItem';\nconst _TextareaItem = isUglify ? TextareaItem : 'TextareaItem';\nconst _Slider = isUglify ? Slider : 'Slider';\nconst _CheckboxItem = isUglify ? Checkbox.CheckboxItem : 'CheckboxItem';\nconst _RadioItem = isUglify ? Radio.RadioItem : 'RadioItem';\nconst _AgreeItem = isUglify ? Checkbox.AgreeItem : 'AgreeItem';\n\nexport class FormItem<T = any, P = {}, Fields = {}, WeakFields = Fields> extends Component<\n    FormItemProps<T, P, Fields, WeakFields>\n> {\n    public static propTypes = {\n        // @ts-ignore\n        ...ListItem.propTypes,\n        label: PropTypes.any,\n        errorLevel: PropTypes.oneOf([0, 1, 2, 'off']),\n        children: PropTypes.element.isRequired\n    };\n\n    public render() {\n        const { props } = this;\n        const { children: childrenList, className, label, errorLevel = errorLevelGlobal, ...fieldProps } = props as any;\n        const children = Children.only(childrenList);\n        const component = getComponentType(children);\n\n        switch (component) {\n            case _Checkbox:\n            case _Radio:\n            case _Switch:\n            case _CheckboxItem:\n            case _RadioItem:\n            case _AgreeItem:\n                fieldProps.__TYPE__ = 'checked';\n                break;\n\n            case 'checked':\n            case 'array':\n            case 'object':\n            case 'number':\n            case 'empty':\n                fieldProps.__TYPE__ = component;\n                break;\n\n            default:\n                fieldProps.__TYPE__ = 'empty';\n                break;\n        }\n\n        return (\n            <EasyField\n                {...fieldProps}\n                passUtil=\"$fieldutil\"\n                children={(\n                    $fieldHandler: $FieldHandler<any, 'value', 'onChange', 'onFocus', 'onBlur', '$fieldutil'>\n                ) => {\n                    const {\n                        valuePropName = 'value',\n                        changePropName = 'onChange',\n                        focusPropName = 'onFocus',\n                        blurPropName = 'onBlur'\n                    } = props;\n                    const {\n                        $fieldutil,\n\n                        // @ts-ignore\n                        [changePropName]: onChange,\n                        // @ts-ignore\n                        [focusPropName]: onFocus,\n                        // @ts-ignore\n                        [blurPropName]: onBlur,\n                        // @ts-ignore\n                        [valuePropName]: value,\n\n                        ...restProps\n                    } = $fieldHandler;\n                    const { $invalid, $dirty, $touched, $getFirstError, $focused } = $fieldutil;\n\n                    let childProps;\n\n                    switch (component) {\n                        case _Checkbox:\n                        case _Radio:\n                        case _Switch:\n                        case _CheckboxItem:\n                        case _RadioItem:\n                        case _AgreeItem:\n                        case 'checked':\n                            const { checked = true, unchecked = false } = props;\n                            childProps = {\n                                checked: value === checked,\n                                onChange: (ev) => {\n                                    const newValue = ev && ev.target ? ev.target.checked : ev;\n                                    onChange(newValue ? checked : unchecked, ev);\n                                }\n                            };\n                            break;\n\n                        case _ImagePicker:\n                            childProps = {\n                                onChange,\n                                files: value\n                            };\n                            break;\n\n                        default:\n                            childProps = {\n                                [changePropName]: onChange,\n                                [valuePropName]: value\n                            };\n                            break;\n                    }\n\n                    Object.assign(childProps, {\n                        [focusPropName]: onFocus,\n                        [blurPropName]: onBlur\n                    });\n\n                    let hasError;\n\n                    switch (errorLevel) {\n                        case 0:\n                            hasError = $invalid && $dirty && $touched;\n                            break;\n                        case 1:\n                            hasError = $invalid && $dirty;\n                            break;\n                        case 2:\n                            hasError = $invalid;\n                            break;\n                        default:\n                            hasError = false;\n                            break;\n                    }\n\n                    const allClassNames = {\n                        invalid: $invalid,\n                        valid: !$invalid,\n                        dirty: $dirty,\n                        pristine: !$dirty,\n                        touched: $touched,\n                        untouched: !$touched,\n                        focused: $focused\n                    };\n\n                    // @ts-ignore\n                    restProps.className = Object.keys(allClassNames)\n                        .filter((key) => allClassNames[key])\n                        .map((key) => `antm-formutil-${key}`)\n                        .concat(className)\n                        .filter(Boolean)\n                        .join(' ');\n\n                    const errorProps = hasError\n                        ? {\n                              error: true\n                          }\n                        : {};\n\n                    switch (component) {\n                        case _InputItem:\n                        case _TextareaItem:\n                            // @ts-ignore\n                            errorProps.onErrorClick = () => {\n                                Modal.alert('Error info', $getFirstError());\n                            };\n\n                        case _CheckboxItem:\n                        case _RadioItem:\n                        case _AgreeItem:\n\n                        case _Range:\n                        case _Slider:\n                        case _PickerView:\n                            return cloneElement(children, {\n                                ...restProps,\n                                ...errorProps,\n                                ...childProps,\n                                title: label,\n                                children: label\n                            });\n\n                        case _DatePicker:\n                        case _Picker:\n                            return cloneElement(children, {\n                                ...childProps,\n                                children: (\n                                    <ListItem {...restProps} {...errorProps}>\n                                        {label}\n                                    </ListItem>\n                                )\n                            });\n\n                        default:\n                            const renderChild = cloneElement(children, childProps);\n\n                            return label ? (\n                                <ListItem {...restProps} {...errorProps} extra={renderChild}>\n                                    {label}\n                                </ListItem>\n                            ) : (\n                                <ListItem {...restProps} {...errorProps}>\n                                    {renderChild}\n                                </ListItem>\n                            );\n                    }\n                }}\n            />\n        );\n    }\n}\n"],"names":["tslib_1.__extends"],"mappings":"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"}